# HybridApp中，Native与Web通信时有哪些坑

## 解答

### 参数过长问题

如果采用协议拦截的方式进行通信的话，参数通过url来发送的。

如果参数过长的话，由于对于URL长度的限制，会将其截断。

解决办法是，

1. 将每次Native调用准备传递的参数放到参数池中
2. Native调用时传递的参数不再是原有参数，而是参数池对应的唯一标识
3. Native端拿到唯一标识后，调用JS方法并传递该标识来获取真正的参数

### 异步回调中如何执行正确的调用

由于schema拦截是一种请求发送，所以也会遇到异步回调会遇到的问题

当同时调用一个Native方法多次时，而Native完成后会只调用最后一次回调。

解决方法是

1. 每次调用Native前，都生成一个唯一的回调标识，并将该标识发送给Native，
2. Native在完成内部调用后，触发的回调函数名称是原回调函数名+回调标识拼接而成
3. JS端也要注册事件监听的名字也是上面的方式拼接而成

## 参考文章

> [HybridApp技术解析 —— 原理篇](https://zhuanlan.zhihu.com/p/54019800)

