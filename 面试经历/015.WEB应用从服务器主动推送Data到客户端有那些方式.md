# WEB应用从服务器主动推送Data到客户端有那些方式？

## 结论

 1. html5 websocket
 2. WebSocket 通过 Flash
 3. XHR长时间连接
 4. 不可见的Iframe
 5. `<script>`标签的长时间连接(可跨域)
 6. Ajax轮询
 
## 详解
 
### html5 websocket

`WebSocket`是HTML5开始提供的一种在单个 `TCP` 连接上进行全双工通讯的协议。

在WebSocket API中，浏览器和服务器只需要做一个握手的动作，然后，浏览器和服务器之间就形成了一条快速通道。两者之间就直接可以数据互相传送。

 * 优点： 实现简单、可靠
 * 缺点： 部分低版本浏览器可能不支持

![img](https://images2015.cnblogs.com/blog/926638/201705/926638-20170508182026957-83496894.png)

### WebSocket通过Flash

Flash Socket：在页面中内嵌入一个使用了Socket类的 `Flash` 程序`JavaScript`通过调用此`Flash`程序提供的Socket接口与服务器端的Socket接口进行通信，JavaScript在收到服务器端传送的信息后控制页面的显示。
 * 优点：实现真正的即时通信，而不是伪即时。
 * 缺点：客户端必须安装Flash插件；非HTTP协议，无法自动穿越防火墙。
 
### XHR长时间连接

客户端打开一个到服务器端的 `AJAX` 请求然后等待响应；服务器端需要一些特定的功能来允许请求被挂起，只要一有事件发生，服务器端就会在挂起的请求中送回响应并关闭该请求。

客户端 JavaScript 响应处理函数会在处理完服务器返回的信息后，再次发出请求，重新建立连接；如此循环。

 * 优点： 对于前端来说实现简单，与普通的网络请求没有太大区别
 * 缺点： 需要服务器端有特殊的功能来临时挂起连接。当客户端发起的连接较多时，服务器端会长期保持多个连接，具有一定的风险。

### 不可见的iframe

在页面中嵌入一个隐藏的`iframe`，将这个隐藏的`iframe`的`src`属性设置为对一个长连接的请求或者采用XRH请求，服务器端就能源源不断地往客户端输入数据。

 * 优点：消息即时到达，不发无用的请求；管理起来也相对方便 
 * 缺点：服务器维护一个长连接会增加开销
 
### `<script>`标签

把 script 标签附加到页面上以让脚本执行。服务器会挂起连接直到有事件发生，接着把脚本内容发送回浏览器，然后重新打开另一个 script 标签来获取下一个事件，从而实现长轮询的模型。

 * 缺点：前后端实现都很麻烦
  
### Ajax轮询

这个思路很简单，就是单纯的定时向服务器发送一个ajax请求，看看有没有最新消息。见过有些网站的扫码登录就是利用这种方式实现的。

 * 优点： 逻辑简单容易实现
 * 缺点： 前端长时间处于轮询占用CPU，并且由于JS是单线程，轮询间隔无法保证

## 参考文章

> * [牛客网前端面试题总结](https://www.nowcoder.com/ta/front-end-interview/review?tpId=10&tqId=11144&query=&asc=true&order=&page=68)
>
> * [服务器有新消息主动推送给客户端浏览器](https://www.cnblogs.com/study-everyday/p/6140498.html)
>
> * [消息推送实现方式](https://www.cnblogs.com/soul-wonder/p/8991893.html)

